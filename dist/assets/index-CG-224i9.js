(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();var $e=Object.defineProperty,Pe=(e,t,a)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,ie=(e,t,a)=>(Pe(e,typeof t!="symbol"?t+"":t,a),a);class ce extends Error{constructor({kind:t,description:a,error:n}){super(JSON.stringify({kind:t,description:a})),ie(this,"kind"),ie(this,"description"),ie(this,"error"),this.kind=t,this.description=a,this.error=n}}class xe extends ce{constructor(t,a){super({kind:"ChatCreationFailed",description:`Failed to create ${a?"persistent":""} chat, mode: ${t}`})}}class Le extends ce{constructor(t){super({kind:"ChatModeDowngraded",description:`Chat mode downgraded to ${t}`})}}class K extends ce{constructor(t,a){super({kind:"ValidationError",description:t}),ie(this,"key"),this.key=a}}class Be extends ce{constructor(t){super({kind:"WSError",description:t})}}var R=(e=>(e.Functional="Functional",e.TextOnly="TextOnly",e.Maintenance="Maintenance",e.Playground="Playground",e.DirectPlayback="DirectPlayback",e.Off="Off",e))(R||{}),G=(e=>(e.Embed="embed",e.Query="query",e.Partial="partial",e.Answer="answer",e.Complete="done",e))(G||{}),v=(e=>(e.Start="START",e.Stop="STOP",e))(v||{}),ne=(e=>(e.Strong="STRONG",e.Weak="WEAK",e.Unknown="UNKNOWN",e))(ne||{}),ee=(e=>(e.Idle="IDLE",e.Talking="TALKING",e))(ee||{}),_=(e=>(e.ChatAnswer="chat/answer",e.ChatPartial="chat/partial",e.StreamDone="stream/done",e.StreamStarted="stream/started",e.StreamFailed="stream/error",e.StreamReady="stream/ready",e.StreamCreated="stream/created",e.StreamInterrupt="stream/interrupt",e.StreamVideoCreated="stream-video/started",e.StreamVideoDone="stream-video/done",e.StreamVideoError="stream-video/error",e.StreamVideoRejected="stream-video/rejected",e))(_||{}),E=(e=>(e.New="new",e.Fail="fail",e.Connected="connected",e.Connecting="connecting",e.Closed="closed",e.Completed="completed",e.Disconnected="disconnected",e))(E||{}),L=(e=>(e.Legacy="legacy",e.Fluent="fluent",e))(L||{});const Oe=45*1e3,ze="X-Playground-Chat",le="https://api.d-id.com",Ne="wss://notifications.d-id.com",Ve="79f81a83a67430be2bc0fd61042b8faa",be=e=>new Promise(t=>setTimeout(t,e)),Y=(e=16)=>{const t=new Uint8Array(e);return window.crypto.getRandomValues(t),Array.from(t,a=>a.toString(16).padStart(2,"0")).join("").slice(0,13)},Fe=e=>[R.TextOnly,R.Playground,R.Maintenance].includes(e),Ce=e=>e&&[R.DirectPlayback,R.Off].includes(e);function Je(e,t){let a;return{promise:new Promise((n,r)=>{a=setTimeout(()=>r(new Error(t)),e)}),clear:()=>clearTimeout(a)}}async function me(e,t){const a={limit:t?.limit??3,delayMs:t?.delayMs??0,timeout:t?.timeout??3e4,timeoutErrorMessage:t?.timeoutErrorMessage||"Timeout error",shouldRetryFn:t?.shouldRetryFn??(()=>!0),onRetry:t?.onRetry??(()=>{})};let n;for(let r=1;r<=a.limit;r++)try{if(!a.timeout)return await e();const{promise:o,clear:s}=Je(a.timeout,a.timeoutErrorMessage),l=e().finally(s);return await Promise.race([l,o])}catch(o){if(n=o,!a.shouldRetryFn(o)||r>=a.limit)throw o;await be(a.delayMs),a.onRetry(o)}throw n}function Me(){let e=window.localStorage.getItem("did_external_key_id");if(!e){let t=Y();window.localStorage.setItem("did_external_key_id",t),e=t}return e}let We=Y();function De(e){if(e.type==="bearer")return`Bearer ${e.token}`;if(e.type==="basic")return`Basic ${btoa(`${e.username}:${e.password}`)}`;if(e.type==="key")return`Client-Key ${e.clientKey}.${Me()}_${We}`;throw new Error(`Unknown auth type: ${e}`)}const qe=e=>me(e,{limit:3,delayMs:1e3,timeout:0,shouldRetryFn:t=>t.status===429});function Ee(e,t=le,a){const n=async(r,o)=>{const{skipErrorHandler:s,...l}=o||{},i=await qe(()=>fetch(t+(r!=null&&r.startsWith("/")?r:`/${r}`),{...l,headers:{...l.headers,Authorization:De(e),"Content-Type":"application/json"}}));if(!i.ok){let u=await i.text().catch(()=>`Failed to fetch with status ${i.status}`);const c=new Error(u);throw a&&!s&&a(c,{url:r,options:l,headers:i.headers}),c}return i.json()};return{get(r,o){return n(r,{...o,method:"GET"})},post(r,o,s){return n(r,{...s,body:JSON.stringify(o),method:"POST"})},delete(r,o,s){return n(r,{...s,body:JSON.stringify(o),method:"DELETE"})},patch(r,o,s){return n(r,{...s,body:JSON.stringify(o),method:"PATCH"})}}}function He(e,t=le,a){const n=Ee(e,`${t}/agents`,a);return{create(r,o){return n.post("/",r,o)},getAgents(r,o){return n.get(`/${r?`?tag=${r}`:""}`,o).then(s=>s??[])},getById(r,o){return n.get(`/${r}`,o)},delete(r,o){return n.delete(`/${r}`,void 0,o)},update(r,o,s){return n.patch(`/${r}`,o,s)},newChat(r,o,s){return n.post(`/${r}/chat`,o,s)},chat(r,o,s,l){return n.post(`/${r}/chat/${o}`,s,l)},createRating(r,o,s,l){return n.post(`/${r}/chat/${o}/ratings`,s,l)},updateRating(r,o,s,l,i){return n.patch(`/${r}/chat/${o}/ratings/${s}`,l,i)},deleteRating(r,o,s,l){return n.delete(`/${r}/chat/${o}/ratings/${s}`,l)},getSTTToken(r,o){return n.get(`/${r}/stt-token`,o)}}}const Ie=e=>e.type==="clip"&&e.presenter_id.startsWith("v2_")?"clip_v2":e.type;function Ke(e){var t,a,n,r;const o=()=>/Mobi|Android/i.test(navigator.userAgent)?"Mobile":"Desktop",s=()=>{const i=navigator.platform;return i.toLowerCase().includes("win")?"Windows":i.toLowerCase().includes("mac")?"Mac OS X":i.toLowerCase().includes("linux")?"Linux":"Unknown"},l=e.presenter;return{$os:`${s()}`,isMobile:`${o()=="Mobile"}`,browser:navigator.userAgent,origin:window.location.origin,agentType:Ie(l),agentVoice:{voiceId:(a=(t=e.presenter)==null?void 0:t.voice)==null?void 0:a.voice_id,provider:(r=(n=e.presenter)==null?void 0:n.voice)==null?void 0:r.type}}}function Ue(e){var t,a,n,r,o,s;const l=(t=e.llm)==null?void 0:t.prompt_customization;return{agentType:Ie(e.presenter),owner_id:e.owner_id??"",promptVersion:(a=e.llm)==null?void 0:a.prompt_version,behavior:{role:l?.role,personality:l?.personality,instructions:(n=e.llm)==null?void 0:n.instructions},temperature:(r=e.llm)==null?void 0:r.temperature,knowledgeSource:l?.knowledge_source,starterQuestionsCount:(s=(o=e.knowledge)==null?void 0:o.starter_message)==null?void 0:s.length,topicsToAvoid:l?.topics_to_avoid,maxResponseLength:l?.max_response_length,agentId:e.id,access:e.access,name:e.preview_name,...e.access==="public"?{from:"agent-template"}:{}}}const Ge=e=>e.reduce((t,a)=>t+a,0),ve=e=>Ge(e)/e.length;function Qe(e,t,a){var n,r,o;const{event:s,...l}=e,{template:i}=t?.llm||{},{language:u}=((n=t?.presenter)==null?void 0:n.voice)||{};return{...l,llm:{...l.llm,template:i},script:{...l.script,provider:{...(r=l?.script)==null?void 0:r.provider,language:u}},stitch:t?.presenter.type==="talk"?(o=t?.presenter)==null?void 0:o.stitch:void 0,...a}}let de={};const Xe="https://api-js.mixpanel.com/track/?verbose=1&ip=1";function Ye(e){const t=window!=null&&window.hasOwnProperty("DID_AGENTS_API")?"agents-ui":"agents-sdk";return{token:e.token||"testKey",distinct_id:e.distinctId||Me(),agentId:e.agentId,additionalProperties:{},isEnabled:e.isEnabled??!0,getRandom:Y,enrich(a){this.additionalProperties={...this.additionalProperties,...a}},async track(a,n){if(!this.isEnabled)return Promise.resolve();const{audioPath:r,...o}=n||{},s={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:JSON.stringify([{event:a,properties:{...this.additionalProperties,...o,agentId:this.agentId,source:t,token:this.token,time:Date.now(),$insert_id:this.getRandom(),origin:window.location.href,"Screen Height":window.screen.height||window.innerWidth,"Screen Width":window.screen.width||window.innerHeight,"User Agent":navigator.userAgent}}])})};try{return await fetch(Xe,s).then(l=>l.json())}catch(l){return console.error(l)}},linkTrack(a,n,r,o){de[a]||(de[a]={events:{},resolvedDependencies:[]}),o.includes(r)||o.push(r);const s=de[a];if(s.events[r]={props:n},s.resolvedDependencies.push(r),o.every(l=>s.resolvedDependencies.includes(l))){const l=o.reduce((i,u)=>s.events[u]?{...i,...s.events[u].props}:i,{});this.track(a,l),s.resolvedDependencies=s.resolvedDependencies.filter(i=>!o.includes(i)),o.forEach(i=>{delete s.events[i]})}}}}function Re(){let e=0;return{reset:()=>e=0,update:()=>e=Date.now(),get:(t=!1)=>t?Date.now()-e:e}}const x=Re(),pe=Re();function Ze(e){return e===R.Playground?{headers:{[ze]:"true"}}:{}}async function Te(e,t,a,n,r=!1,o){try{return!o&&!Ce(n)&&(o=await t.newChat(e.id,{persist:r},Ze(n)),a.track("agent-chat",{event:"created",chatId:o.id,mode:n})),{chat:o,chatMode:o?.chat_mode??n}}catch(s){try{const l=JSON.parse(s.message);if(l?.kind==="InsufficientCreditsError")throw new Error("InsufficientCreditsError")}catch(l){console.error("Error parsing the error message:",l)}throw new Error("Cannot create new chat")}}function et(e){return e&&e.length>0?e:[]}function tt(e,t,a){if(!e)throw new Error("Please connect to the agent first");if(!e.interruptAvailable)throw new Error("Interrupt is not enabled for this stream");if(t!==L.Fluent)throw new Error("Interrupt only available for Fluent streams");if(!a)throw new Error("No active video to interrupt")}async function nt(e,t){const a={type:_.StreamInterrupt,videoId:t,timestamp:Date.now()};e.sendDataChannelMessage(JSON.stringify(a))}function at(e){return new Promise((t,a)=>{const{callbacks:n,host:r,auth:o}=e,{onMessage:s=null,onOpen:l=null,onClose:i=null,onError:u=null}=n||{},c=new WebSocket(`${r}?authorization=${De(o)}`);c.onmessage=s,c.onclose=i,c.onerror=p=>{console.error(p),u?.("Websocket failed to connect",p),a(p)},c.onopen=p=>{l?.(p),t(c)}})}async function rt(e){const{retries:t=1}=e;let a=null;for(let n=0;a?.readyState!==WebSocket.OPEN;n++)try{a=await at(e)}catch(r){if(n===t)throw r;await be(n*500)}return a}async function ot(e,t,a){const n=a!=null&&a.onMessage?[a.onMessage]:[],r=await rt({auth:e,host:t,callbacks:{onError:o=>{var s;return(s=a.onError)==null?void 0:s.call(a,new Be(o))},onMessage(o){const s=JSON.parse(o.data);n.forEach(l=>l(s.event,s))}}});return{socket:r,disconnect:()=>r.close(),subscribeToEvents:o=>n.push(o)}}function it(e){if(e.answer!==void 0)return e.answer;let t=0,a="";for(;t in e;)a+=e[t++];return a}function st(e,t,a,n,r){const o=n.messages[n.messages.length-1];if(!(e===G.Partial||e===G.Answer)||o?.role!=="assistant")return;const{content:s,sequence:l}=t;e===G.Partial?a[l]=s:a.answer=s;const i=it(a);(o.content!==i||e===G.Answer)&&(o.content=i,r?.([...n.messages],e))}function ct(e,t,a,n,r){let o={};return{clearQueue:()=>o={},onMessage:(s,l)=>{var i,u;if("content"in l)st(s,l,o,t,a.callbacks.onNewMessage),s===G.Answer&&e.track("agent-message-received",{messages:t.messages.length,mode:t.chatMode});else{const c=_,p=[c.StreamVideoDone,c.StreamVideoError,c.StreamVideoRejected],S=[c.StreamFailed,c.StreamVideoError,c.StreamVideoRejected],h=Qe(l,n,{mode:t.chatMode});if(s=s,s===c.StreamVideoCreated)e.linkTrack("agent-video",h,c.StreamVideoCreated,["start"]);else if(p.includes(s)){const Z=s.split("/")[1];S.includes(s)?e.track("agent-video",{...h,event:Z}):e.linkTrack("agent-video",{...h,event:Z},s,["done"])}S.includes(s)&&((u=(i=a.callbacks).onError)==null||u.call(i,new Error(`Stream failed with event ${s}`),{data:l})),l.event===c.StreamDone&&r()}}}}function lt(e,t,a,n){const r=Ee(e,`${t}/agents/${a}`,n);return{createStream(o){return r.post("/streams",o)},startConnection(o,s,l){return r.post(`/streams/${o}/sdp`,{session_id:l,answer:s})},addIceCandidate(o,s,l){return r.post(`/streams/${o}/ice`,{session_id:l,...s})},sendStreamRequest(o,s,l){return r.post(`/streams/${o}`,{session_id:s,...l})},close(o,s){return r.delete(`/streams/${o}`,{session_id:s})}}}function dt(e,t,a){const n=(t.timestamp-e.timestamp)/1e3;return{duration:n,bytesReceived:t.bytesReceived-e.bytesReceived,bitrate:Math.round((t.bytesReceived-e.bytesReceived)*8/n),packetsReceived:t.packetsReceived-e.packetsReceived,packetsLost:t.packetsLost-e.packetsLost,framesDropped:t.framesDropped-e.framesDropped,framesDecoded:t.framesDecoded-e.framesDecoded,jitter:t.jitter,avgJitterDelayInInterval:(t.jitterBufferDelay-e.jitterBufferDelay)/(t.jitterBufferEmittedCount-e.jitterBufferEmittedCount),jitterBufferEmittedCount:t.jitterBufferEmittedCount-e.jitterBufferEmittedCount,jitterBufferDelay:(t.jitterBufferDelay-e.jitterBufferDelay)/n,framesPerSecond:t.framesPerSecond,freezeCount:t.freezeCount-e.freezeCount,freezeDuration:t.freezeDuration-e.freezeDuration,lowFpsCount:a}}function ut(e){return e.filter(t=>t.freezeCount>0||t.framesPerSecond<21||t.framesDropped>0||t.packetsLost>0).map(t=>{const{timestamp:a,...n}=t,r=[];return t.freezeCount>0&&r.push("freeze"),t.framesPerSecond<21&&r.push("low fps"),t.framesDropped>0&&r.push("frames dropped"),t.packetsLost>0&&r.push("packet loss"),{...n,causes:r}})}function mt(e){let t="",a=0;for(const n of e.values())if(n&&n.type==="codec"&&n.mimeType.startsWith("video")&&(t=n.mimeType.split("/")[1]),n&&n.type==="candidate-pair"&&(a=n.currentRoundTripTime),n&&n.type==="inbound-rtp"&&n.kind==="video")return{codec:t,rtt:a,timestamp:n.timestamp,bytesReceived:n.bytesReceived,packetsReceived:n.packetsReceived,packetsLost:n.packetsLost,framesDropped:n.framesDropped,framesDecoded:n.framesDecoded,jitter:n.jitter,jitterBufferDelay:n.jitterBufferDelay,jitterBufferEmittedCount:n.jitterBufferEmittedCount,avgJitterDelayInInterval:n.jitterBufferDelay/n.jitterBufferEmittedCount,frameWidth:n.frameWidth,frameHeight:n.frameHeight,framesPerSecond:n.framesPerSecond,freezeCount:n.freezeCount,freezeDuration:n.totalFreezesDuration};return{}}function pt(e,t,a){const n=e.map((i,u)=>u===0?a?{timestamp:i.timestamp,duration:0,rtt:i.rtt,bytesReceived:i.bytesReceived-a.bytesReceived,bitrate:(i.bytesReceived-a.bytesReceived)*8/(t/1e3),packetsReceived:i.packetsReceived-a.packetsReceived,packetsLost:i.packetsLost-a.packetsLost,framesDropped:i.framesDropped-a.framesDropped,framesDecoded:i.framesDecoded-a.framesDecoded,jitter:i.jitter,jitterBufferDelay:i.jitterBufferDelay-a.jitterBufferDelay,jitterBufferEmittedCount:i.jitterBufferEmittedCount-a.jitterBufferEmittedCount,avgJitterDelayInInterval:(i.jitterBufferDelay-a.jitterBufferDelay)/(i.jitterBufferEmittedCount-a.jitterBufferEmittedCount),framesPerSecond:i.framesPerSecond,freezeCount:i.freezeCount-a.freezeCount,freezeDuration:i.freezeDuration-a.freezeDuration}:{timestamp:i.timestamp,rtt:i.rtt,duration:0,bytesReceived:i.bytesReceived,bitrate:i.bytesReceived*8/(t/1e3),packetsReceived:i.packetsReceived,packetsLost:i.packetsLost,framesDropped:i.framesDropped,framesDecoded:i.framesDecoded,jitter:i.jitter,jitterBufferDelay:i.jitterBufferDelay,jitterBufferEmittedCount:i.jitterBufferEmittedCount,avgJitterDelayInInterval:i.jitterBufferDelay/i.jitterBufferEmittedCount,framesPerSecond:i.framesPerSecond,freezeCount:i.freezeCount,freezeDuration:i.freezeDuration}:{timestamp:i.timestamp,duration:t*u/1e3,rtt:i.rtt,bytesReceived:i.bytesReceived-e[u-1].bytesReceived,bitrate:(i.bytesReceived-e[u-1].bytesReceived)*8/(t/1e3),packetsReceived:i.packetsReceived-e[u-1].packetsReceived,packetsLost:i.packetsLost-e[u-1].packetsLost,framesDropped:i.framesDropped-e[u-1].framesDropped,framesDecoded:i.framesDecoded-e[u-1].framesDecoded,jitter:i.jitter,jitterBufferDelay:i.jitterBufferDelay-e[u-1].jitterBufferDelay,jitterBufferEmittedCount:i.jitterBufferEmittedCount-e[u-1].jitterBufferEmittedCount,avgJitterDelayInInterval:(i.jitterBufferDelay-e[u-1].jitterBufferDelay)/(i.jitterBufferEmittedCount-e[u-1].jitterBufferEmittedCount),framesPerSecond:i.framesPerSecond,freezeCount:i.freezeCount-e[u-1].freezeCount,freezeDuration:i.freezeDuration-e[u-1].freezeDuration}),r=ut(n),o=r.reduce((i,u)=>i+(u.causes.includes("low fps")?1:0),0),s=n.filter(i=>!!i.avgJitterDelayInInterval).map(i=>i.avgJitterDelayInInterval),l=n.filter(i=>!!i.rtt).map(i=>i.rtt);return{webRTCStats:{anomalies:r,minRtt:Math.min(...l),avgRtt:ve(l),maxRtt:Math.max(...l),aggregateReport:dt(e[0],e[e.length-1],o),minJitterDelayInInterval:Math.min(...s),maxJitterDelayInInterval:Math.max(...s),avgJitterDelayInInterval:ve(s)},codec:e[0].codec,resolution:`${e[0].frameWidth}x${e[0].frameHeight}`}}const ge=100,gt=Math.max(Math.ceil(400/ge),1),ft=.25,ht=.28;function vt(){let e=0,t,a,n=0;return r=>{for(const o of r.values())if(o&&o.type==="inbound-rtp"&&o.kind==="video"){const s=o.jitterBufferDelay,l=o.jitterBufferEmittedCount;if(a&&l>a){const c=s-t,p=l-a;n=c/p}t=s,a=l;const i=o.framesDecoded,u=i-e>0;return e=i,{isReceiving:u,avgJitterDelayInInterval:n,freezeCount:o.freezeCount}}return{isReceiving:!1,avgJitterDelayInInterval:n}}}function yt(e,t,a,n,r,o=!1){let s=[],l,i=0,u=!1,c=ne.Unknown,p=ne.Unknown,S=0,h=0;const Z=vt();return setInterval(async()=>{const q=await e.getStats(),{isReceiving:H,avgJitterDelayInInterval:b,freezeCount:N}=Z(q),J=mt(q);if(H)i=0,S=N-h,p=b<ft?ne.Strong:b>ht&&S>1?ne.Weak:c,p!==c&&(r?.(p),c=p,h+=S,S=0),u||(n?.(v.Start),l=s[s.length-1],s=[],u=!0),s.push(J);else if(u&&(i++,i>=gt)){const d=pt(s,ge,l);n?.(v.Stop,d),t()||a(),h=N,u=!1}},ge)}let je=!1;const $=(e,t)=>je&&console.log(e,t),wt=(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection).bind(window);function ye(e){switch(e){case"connected":return E.Connected;case"checking":return E.Connecting;case"failed":return E.Fail;case"new":return E.New;case"closed":return E.Closed;case"disconnected":return E.Disconnected;case"completed":return E.Completed;default:return E.New}}function St(e){const[t,a=""]=e.split(/:(.+)/);try{const n=JSON.parse(a);return $("parsed data channel message",{subject:t,data:n}),{subject:t,data:n}}catch(n){return $("Failed to parse data channel message, returning data as string",{subject:t,rawData:a,error:n}),{subject:t,data:a}}}function kt({statsSignal:e,dataChannelSignal:t,onVideoStateChange:a,report:n}){e===v.Start&&t===v.Start?a?.(v.Start):e===v.Stop&&t===v.Stop&&a?.(v.Stop,n)}function bt({statsSignal:e,dataChannelSignal:t,onVideoStateChange:a,onAgentActivityStateChange:n,report:r}){e===v.Start?a?.(v.Start):e===v.Stop&&a?.(v.Stop,r),t===v.Start?n?.(ee.Talking):t===v.Stop&&n?.(ee.Idle)}function we({statsSignal:e,dataChannelSignal:t,onVideoStateChange:a,onAgentActivityStateChange:n,streamType:r,report:o}){r===L.Legacy?kt({statsSignal:e,dataChannelSignal:t,onVideoStateChange:a,report:o}):r===L.Fluent&&bt({statsSignal:e,dataChannelSignal:t,onVideoStateChange:a,onAgentActivityStateChange:n,report:o})}async function Ct(e,t,{debug:a=!1,callbacks:n,auth:r,baseURL:o=le,analytics:s}){var l;je=a;let i=!1,u=!1,c=v.Stop,p=v.Stop;const{startConnection:S,sendStreamRequest:h,close:Z,createStream:q,addIceCandidate:H}=lt(r,o,e,n.onError),{id:b,offer:N,ice_servers:J,session_id:d,fluent:y,interrupt_enabled:w}=await q(t);(l=n.onStreamCreated)==null||l.call(n,{stream_id:b,session_id:d,agent_id:e});const f=new wt({iceServers:J}),D=f.createDataChannel("JanusDataChannel");if(!d)throw new Error("Could not create session_id");const k=y?L.Fluent:L.Legacy;s.enrich({"stream-type":k});const B=t.stream_warmup&&!y,V=()=>i,O=()=>{var m;i=!0,u&&((m=n.onConnectionStateChange)==null||m.call(n,E.Connected))},C=yt(f,V,O,(m,g)=>we({statsSignal:p=m,dataChannelSignal:k===L.Legacy?c:void 0,onVideoStateChange:n.onVideoStateChange,onAgentActivityStateChange:n.onAgentActivityStateChange,report:g,streamType:k}),m=>{var g;return(g=n.onConnectivityStateChange)==null?void 0:g.call(n,m)},B);f.onicecandidate=m=>{var g;$("peerConnection.onicecandidate",m);try{m.candidate&&m.candidate.sdpMid&&m.candidate.sdpMLineIndex!==null?H(b,{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex},d):H(b,{candidate:null},d)}catch(j){(g=n.onError)==null||g.call(n,j,{streamId:b})}},D.onopen=()=>{u=!0,(!B||i)&&O()};const T=m=>{var g;(g=n.onVideoIdChange)==null||g.call(n,m)};function M(m,g){if(m===_.StreamStarted&&typeof g=="object"&&"metadata"in g){const j=g.metadata;T(j.videoId)}m===_.StreamDone&&T(null),c=m===_.StreamStarted?v.Start:v.Stop,we({statsSignal:k===L.Legacy?p:void 0,dataChannelSignal:c,onVideoStateChange:n.onVideoStateChange,onAgentActivityStateChange:n.onAgentActivityStateChange,streamType:k})}function I(m,g){const j=typeof g=="string"?g:g?.metadata;j&&s.enrich({streamMetadata:j}),s.track("agent-chat",{event:"ready"})}const A={[_.StreamStarted]:M,[_.StreamDone]:M,[_.StreamReady]:I};D.onmessage=m=>{var g;const{subject:j,data:ae}=St(m.data);(g=A[j])==null||g.call(A,j,ae)},f.oniceconnectionstatechange=()=>{var m;$("peerConnection.oniceconnectionstatechange => "+f.iceConnectionState);const g=ye(f.iceConnectionState);g!==E.Connected&&((m=n.onConnectionStateChange)==null||m.call(n,g))},f.ontrack=m=>{var g;$("peerConnection.ontrack",m),(g=n.onSrcObjectReady)==null||g.call(n,m.streams[0])},await f.setRemoteDescription(N),$("set remote description OK");const z=await f.createAnswer();return $("create answer OK"),await f.setLocalDescription(z),$("set local description OK"),await S(b,z,d),$("start connection OK"),{speak(m){return h(b,d,m)},async disconnect(){var m;if(b){const g=ye(f.iceConnectionState);if(f){if(g===E.New){clearInterval(C);return}f.close(),f.oniceconnectionstatechange=null,f.onnegotiationneeded=null,f.onicecandidate=null,f.ontrack=null}try{g===E.Connected&&await Z(b,d).catch(j=>{})}catch(j){$("Error on close stream connection",j)}(m=n.onAgentActivityStateChange)==null||m.call(n,ee.Idle),clearInterval(C)}},sendDataChannelMessage(m){var g,j;if(!i||D.readyState!=="open"){$("Data channel is not ready for sending messages"),(g=n.onError)==null||g.call(n,new Error("Data channel is not ready for sending messages"),{streamId:b});return}try{D.send(m)}catch(ae){$("Error sending data channel message",ae),(j=n.onError)==null||j.call(n,ae,{streamId:b})}},sessionId:d,streamId:b,streamType:k,interruptAvailable:w}}function Mt(e){const{streamOptions:t}=e??{};return{output_resolution:t?.outputResolution,session_timeout:t?.sessionTimeout,stream_warmup:t?.streamWarmup,compatibility_mode:t?.compatibilityMode,fluent:t?.fluent}}function Dt(e,t,a,n,r){r===L.Fluent?Et(e,t,a,n,r):Rt(e,t,a,n,r)}function Et(e,t,a,n,r){e===v.Start?n.track("stream-session",{event:"start","stream-type":r}):e===v.Stop&&n.track("stream-session",{event:"stop",is_greenscreen:t.presenter.type==="clip"&&t.presenter.is_greenscreen,background:t.presenter.type==="clip"&&t.presenter.background,"stream-type":r,...a})}function It(e,t,a,n){x.get()<=0||(e===v.Start?a.linkTrack("agent-video",{event:"start",latency:x.get(!0),"stream-type":n},"start",[_.StreamVideoCreated]):e===v.Stop&&a.linkTrack("agent-video",{event:"stop",is_greenscreen:t.presenter.type==="clip"&&t.presenter.is_greenscreen,background:t.presenter.type==="clip"&&t.presenter.background,"stream-type":n},"done",[_.StreamVideoDone]))}function Rt(e,t,a,n,r){x.get()<=0||(e===v.Start?n.linkTrack("agent-video",{event:"start",latency:x.get(!0),"stream-type":r},"start",[_.StreamVideoCreated]):e===v.Stop&&n.linkTrack("agent-video",{event:"stop",is_greenscreen:t.presenter.type==="clip"&&t.presenter.is_greenscreen,background:t.presenter.type==="clip"&&t.presenter.background,"stream-type":r,...a},"done",[_.StreamVideoDone]))}function Zt(e,t,a){return x.reset(),new Promise(async(n,r)=>{try{const o=await Ct(e.id,Mt(t),{...t,analytics:a,callbacks:{...t.callbacks,onConnectionStateChange:s=>{var l,i;(i=(l=t.callbacks).onConnectionStateChange)==null||i.call(l,s),s===E.Connected&&n(o)},onVideoStateChange:(s,l)=>{var i,u;(u=(i=t.callbacks).onVideoStateChange)==null||u.call(i,s),Dt(s,e,l,a,o.streamType)},onAgentActivityStateChange:s=>{var l,i;(i=(l=t.callbacks).onAgentActivityStateChange)==null||i.call(l,s),s===ee.Talking?pe.update():pe.reset(),It(s===ee.Talking?v.Start:v.Stop,e,a,o.streamType)}}})}catch(o){r(o)}})}async function Tt(e,t,a,n,r){var o,s,l,i;const u=Te(e,a,n,t.mode,t.persistentChat,r),c=Zt(e,t,n),[p,S]=await Promise.all([u,c]),{chat:h,chatMode:Z}=p;return Z&&Z!==t.mode&&(t.mode=Z,(s=(o=t.callbacks).onModeChange)==null||s.call(o,Z),Z!==R.Functional)?((i=(l=t.callbacks).onError)==null||i.call(l,new Le(Z)),S?.disconnect(),{chat:h}):{chat:h,streamingManager:S}}async function jt(e,t){var a,n,r;let o=!0,s=null;const l=t.mixpanelKey||Ve,i=t.wsURL||Ne,u=t.baseURL||le,c={messages:[],chatMode:t.mode||R.Functional},p=Ye({token:l,agentId:e,isEnabled:t.enableAnalitics,distinctId:t.distinctId});p.track("agent-sdk",{event:"init"});const S=He(t.auth,u,t.callbacks.onError),h=await S.getById(e);p.enrich(Ue(h));const{onMessage:Z,clearQueue:q}=ct(p,c,t,h,()=>{var d;return(d=c.socketManager)==null?void 0:d.disconnect()});c.messages=et(t.initialMessages),(n=(a=t.callbacks).onNewMessage)==null||n.call(a,[...c.messages],"answer");const H=d=>{s=d};p.track("agent-sdk",{event:"loaded",...Ke(h)});async function b(d){var y,w,f,D,k,B,V;(w=(y=t.callbacks).onConnectionStateChange)==null||w.call(y,E.Connecting),x.reset(),d&&!o&&(delete c.chat,(D=(f=t.callbacks).onNewMessage)==null||D.call(f,[...c.messages],"answer"));const O=t.mode===R.DirectPlayback?Promise.resolve(void 0):ot(t.auth,i,{onMessage:Z,onError:t.callbacks.onError}),C=me(()=>Tt(h,{...t,callbacks:{...t.callbacks,onVideoIdChange:H}},S,p,c.chat),{limit:3,timeout:Oe,timeoutErrorMessage:"Timeout initializing the stream",shouldRetryFn:A=>A?.message!=="Could not connect"&&A.status!==429,delayMs:1e3}).catch(A=>{var z,m;throw J(R.Maintenance),(m=(z=t.callbacks).onConnectionStateChange)==null||m.call(z,E.Fail),A}),[T,{streamingManager:M,chat:I}]=await Promise.all([O,C]);I&&I.id!==((k=c.chat)==null?void 0:k.id)&&((V=(B=t.callbacks).onNewChat)==null||V.call(B,I.id)),c.streamingManager=M,c.socketManager=T,c.chat=I,o=!1,p.enrich({chatId:I?.id,streamId:M?.streamId,mode:c.chatMode}),J(I?.chat_mode??t.mode??R.Functional)}async function N(){var d,y,w,f;(d=c.socketManager)==null||d.disconnect(),await((y=c.streamingManager)==null?void 0:y.disconnect()),delete c.streamingManager,delete c.socketManager,(f=(w=t.callbacks).onConnectionStateChange)==null||f.call(w,E.Disconnected)}async function J(d){var y,w;d!==c.chatMode&&(p.track("agent-mode-change",{mode:d}),c.chatMode=d,c.chatMode!==R.Functional&&await N(),(w=(y=t.callbacks).onModeChange)==null||w.call(y,d))}return{agent:h,getStreamType:()=>{var d;return(d=c.streamingManager)==null?void 0:d.streamType},getIsInterruptAvailable:()=>{var d;return((d=c.streamingManager)==null?void 0:d.interruptAvailable)??!1},starterMessages:((r=h.knowledge)==null?void 0:r.starter_message)||[],getSTTToken:()=>S.getSTTToken(h.id),changeMode:J,enrichAnalytics:p.enrich,async connect(){await b(!0),p.track("agent-chat",{event:"connect",mode:c.chatMode})},async reconnect(){await N(),await b(!1),p.track("agent-chat",{event:"reconnect",mode:c.chatMode})},async disconnect(){await N(),p.track("agent-chat",{event:"disconnect",mode:c.chatMode})},async chat(d){var y,w,f,D,k;const B=()=>{if(Ce(t.mode))throw new K(`${t.mode} is enabled, chat is disabled`);if(d.length>=800)throw new K("Message cannot be more than 800 characters");if(d.length===0)throw new K("Message cannot be empty");if(c.chatMode===R.Maintenance)throw new K("Chat is in maintenance mode");if(![R.TextOnly,R.Playground].includes(c.chatMode)){if(!c.streamingManager)throw new K("Streaming manager is not initialized");if(!c.chat)throw new K("Chat is not initialized")}},V=async()=>{var C,T;if(!c.chat){const M=await Te(h,S,p,c.chatMode,t.persistentChat);if(!M.chat)throw new xe(c.chatMode,!!t.persistentChat);c.chat=M.chat,(T=(C=t.callbacks).onNewChat)==null||T.call(C,c.chat.id)}return c.chat.id},O=async(C,T)=>me(()=>{var M,I;return S.chat(h.id,T,{chatMode:c.chatMode,streamId:(M=c.streamingManager)==null?void 0:M.streamId,sessionId:(I=c.streamingManager)==null?void 0:I.sessionId,messages:C.map(({matches:A,...z})=>z)},{...Ze(c.chatMode),skipErrorHandler:!0})},{limit:2,shouldRetryFn:M=>{var I,A,z,m;const g=(I=M?.message)==null?void 0:I.includes("missing or invalid session_id");return!((A=M?.message)!=null&&A.includes("Stream Error"))&&!g?((m=(z=t.callbacks).onError)==null||m.call(z,M),!1):!0},onRetry:async()=>{await N(),await b(!1)}});try{q(),B(),c.messages.push({id:Y(),role:"user",content:d,created_at:new Date(x.update()).toISOString()}),(w=(y=t.callbacks).onNewMessage)==null||w.call(y,[...c.messages],"user");const C=await V(),T=await O([...c.messages],C);return c.messages.push({id:Y(),role:"assistant",content:T.result||"",created_at:new Date().toISOString(),context:T.context,matches:T.matches}),p.track("agent-message-send",{event:"success",messages:c.messages.length+1}),T.result&&((D=(f=t.callbacks).onNewMessage)==null||D.call(f,[...c.messages],"answer"),p.track("agent-message-received",{latency:x.get(!0),messages:c.messages.length})),T}catch(C){throw((k=c.messages[c.messages.length-1])==null?void 0:k.role)==="assistant"&&c.messages.pop(),p.track("agent-message-send",{event:"error",messages:c.messages.length}),C}},rate(d,y,w){var f,D,k,B;const V=c.messages.find(C=>C.id===d);if(c.chat){if(!V)throw new Error("Message not found")}else throw new Error("Chat is not initialized");const O=((f=V.matches)==null?void 0:f.map(C=>[C.document_id,C.id]))??[];return p.track("agent-rate",{event:w?"update":"create",thumb:y===1?"up":"down",knowledge_id:((D=h.knowledge)==null?void 0:D.id)??"",matches:O,score:y}),w?S.updateRating(h.id,c.chat.id,w,{knowledge_id:((k=h.knowledge)==null?void 0:k.id)??"",message_id:d,matches:O,score:y}):S.createRating(h.id,c.chat.id,{knowledge_id:((B=h.knowledge)==null?void 0:B.id)??"",message_id:d,matches:O,score:y})},deleteRate(d){if(!c.chat)throw new Error("Chat is not initialized");return p.track("agent-rate-delete",{type:"text"}),S.deleteRating(h.id,c.chat.id,d)},async speak(d){var y,w,f;function D(){if(typeof d=="string"){if(!h.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:h.presenter.voice,input:d,ssml:!1}}if(d.type==="text"&&!d.provider){if(!h.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:h.presenter.voice,input:d.input,ssml:d.ssml}}return d}const k=D();if(p.track("agent-speak",k),x.update(),c.messages&&k.type==="text"&&(c.messages.push({id:Y(),role:"assistant",content:k.input,created_at:new Date(x.get(!0)).toISOString()}),(w=(y=t.callbacks).onNewMessage)==null||w.call(y,[...c.messages],"answer")),Fe(c.chatMode))return{duration:0,video_id:"",status:"success"};if(!c.streamingManager)throw new Error("Please connect to the agent first");return c.streamingManager.speak({script:k,metadata:{chat_id:(f=c.chat)==null?void 0:f.id,agent_id:h.id}})},async interrupt({type:d}){var y,w,f;tt(c.streamingManager,(y=c.streamingManager)==null?void 0:y.streamType,s);const D=c.messages[c.messages.length-1];p.track("agent-video-interrupt",{type:d||"click",video_duration_to_interrupt:pe.get(!0),message_duration_to_interrupt:x.get(!0)}),D.interrupted=!0,(f=(w=t.callbacks).onNewMessage)==null||f.call(w,[...c.messages],"answer"),nt(c.streamingManager,s)}}}let _e={type:"key",clientKey:"YXV0aDB8Njg2NmRiNGI5ZTUzZWFiZmEzMmIxNGZjOnJZNWxqZmQwWHZJc1A5UFlUVkxVRg=="},Ae="v2_agt_QD6lFxN7",F=document.querySelector("#streamVideoElement"),U=document.querySelector("#idleVideoElement"),W=document.querySelector("#textArea"),Q=document.querySelector("#speechButton"),te=document.querySelector("#answers"),_t=document.querySelector("#reconnectButton"),X=document.querySelector("#actionButton"),re=document.querySelector("#video-wrapper"),fe=document.querySelector("#interruptButton"),oe=new Set,ue,se;const At={onSrcObjectReady(e){return console.log("SrcObject Ready"),F.srcObject=e,ue=e,ue},onConnectionStateChange(e){console.log("Connection State: ",e),e=="connecting"?(document.querySelector("#container").style.display="flex",document.querySelector("#hidden").style.display="none",U.src=P.agent.presenter.idle_video,U.play(),re.style.filter="blur(5px)",F.style.opacity=0,U.style.opacity=1,re.style.backgroundImage=`url(${P.agent.presenter.thumbnail})`):e=="connected"?(W.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),he())}),document.addEventListener("keydown",t=>{t.key==="Tab"&&(t.preventDefault(),ke())}),X.removeAttribute("disabled"),Q.removeAttribute("disabled"),te.innerHTML+=`<div class='agentMessage'>${P.agent.greetings[0]}</div><br>`,se!==L.Fluent&&(re.style.filter="blur(0px)")):(e=="disconnected"||e=="closed")&&(W.removeEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),he())}),document.removeEventListener("keydown",t=>{t.key==="Tab"&&(t.preventDefault(),ke())}),document.querySelector("#hidden_h2").innerHTML=`${P.agent.preview_name} Disconnected`,document.querySelector("#hidden").style.display="flex",document.querySelector("#container").style.display="none",X.setAttribute("disabled",!0),Q.setAttribute("disabled",!0),document.getElementById("video-wrapper").style.filter="blur(5px)")},onVideoStateChange(e){console.log("Video State: ",e),se==L.Fluent?e=="START"&&(re.style.filter="blur(0px)",F.style.opacity=1,U.style.opacity=0):e=="START"?(F.muted=!1,F.srcObject=ue,U.style.opacity=0,F.style.opacity=1):(F.muted=!0,U.style.opacity=1,F.style.opacity=0)},onNewMessage(e,t){let a=e.length-1,n=e[a];if(n){if(n&&n.role=="assistant"&&e.length!=1){if(t=="answer"){if(n.id&&oe.has(n.id))return;n.id&&oe.add(n.id),te.innerHTML+=`<div class='agentMessage'> ${n.content} <div class="ratingButtons"> <button id='${n.id}_plus' title='agentManager.rate() -> Rate this answer (+)'><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none">
                <path fill="currentcolor" d="m11.986 7.1-.41-.071.41.07Zm-.392 2.266-.41-.07.41.07Zm-7.406 2.34-.415.036.415-.036Zm-.452-5.218.416-.036-.416.036Zm4.372-3.257.411.067-.41-.067ZM7.74 5.478l.411.067-.41-.067Zm-3.685.229-.272-.316.272.316Zm.799-.69.272.317-.272-.316Zm1.323-2.03-.404-.104.404.105ZM6.44 1.97l.403.105-.403-.105Zm.93-.492-.128.397.128-.397Zm.08.026.128-.397-.128.397ZM5.812 3.921l.368.196-.368-.196Zm2.246-1.787-.403.105.403-.105ZM6.82 1.515l-.18-.375.18.375Zm-4.28 10.743-.414.036.415-.036ZM2 6.016l.415-.036a.417.417 0 0 0-.832.036H2Zm9.576 1.013-.392 2.266.82.142.393-2.266-.821-.142Zm-3.884 5.107H5.109v.833h2.583v-.833Zm-3.09-.465-.45-5.219-.83.072.45 5.218.83-.071Zm6.582-2.376c-.282 1.629-1.75 2.84-3.492 2.84v.834c2.125 0 3.958-1.483 4.313-3.532l-.821-.142ZM7.697 3.164 7.33 5.41l.822.134.368-2.247-.822-.134Zm-3.37 2.858.799-.688-.544-.632-.8.689.545.631Zm2.253-2.93.264-1.018-.806-.21-.265 1.02.807.209Zm.663-1.218.081.026.255-.794-.08-.026-.256.794ZM6.18 4.117c.173-.325.308-.668.4-1.024l-.807-.21a3.821 3.821 0 0 1-.328.841l.735.393ZM7.324 1.9c.17.054.291.186.33.34l.807-.21a1.325 1.325 0 0 0-.882-.924l-.255.794Zm-.48.174A.286.286 0 0 1 7 1.89l-.362-.75a1.119 1.119 0 0 0-.6.725l.806.209ZM7 1.89a.331.331 0 0 1 .243-.016l.255-.794a1.164 1.164 0 0 0-.86.06L7 1.89Zm1.196 4.543h2.879v-.834H8.196v.834Zm-5.241 5.79-.54-6.243-.83.072.54 6.242.83-.071Zm-.538.059V6.016h-.834v6.266h.834Zm-.292.012a.146.146 0 0 1 .145-.158v.833c.404 0 .72-.345.685-.746l-.83.071Zm6.394-8.996c.07-.422.05-.854-.058-1.268l-.806.21c.078.301.093.616.042.924l.822.134Zm-3.41 8.838a.509.509 0 0 1-.506-.465l-.83.071c.06.694.64 1.227 1.336 1.227v-.833Zm.017-6.802c.378-.326.785-.713 1.054-1.217l-.735-.393c-.193.36-.5.665-.863.978l.544.632Zm7.27 1.837a1.342 1.342 0 0 0-1.321-1.572v.834c.315 0 .555.284.5.596l.822.142ZM2.27 12.136c.082 0 .147.066.147.146h-.834c0 .379.307.687.687.687v-.833ZM7.33 5.41a.88.88 0 0 0 .867 1.022v-.834a.046.046 0 0 1-.045-.054l-.822-.134ZM4.152 6.452a.51.51 0 0 1 .175-.43l-.544-.631a1.343 1.343 0 0 0-.462 1.133l.83-.072Z"/>
                </svg></button> <button id='${n.id}_minus' title='agentManager.rate() -> Rate this answer (-)'><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" style="rotate: 180deg;">
                <path fill="currentcolor" d="m11.986 7.1-.41-.071.41.07Zm-.392 2.266-.41-.07.41.07Zm-7.406 2.34-.415.036.415-.036Zm-.452-5.218.416-.036-.416.036Zm4.372-3.257.411.067-.41-.067ZM7.74 5.478l.411.067-.41-.067Zm-3.685.229-.272-.316.272.316Zm.799-.69.272.317-.272-.316Zm1.323-2.03-.404-.104.404.105ZM6.44 1.97l.403.105-.403-.105Zm.93-.492-.128.397.128-.397Zm.08.026.128-.397-.128.397ZM5.812 3.921l.368.196-.368-.196Zm2.246-1.787-.403.105.403-.105ZM6.82 1.515l-.18-.375.18.375Zm-4.28 10.743-.414.036.415-.036ZM2 6.016l.415-.036a.417.417 0 0 0-.832.036H2Zm9.576 1.013-.392 2.266.82.142.393-2.266-.821-.142Zm-3.884 5.107H5.109v.833h2.583v-.833Zm-3.09-.465-.45-5.219-.83.072.45 5.218.83-.071Zm6.582-2.376c-.282 1.629-1.75 2.84-3.492 2.84v.834c2.125 0 3.958-1.483 4.313-3.532l-.821-.142ZM7.697 3.164 7.33 5.41l.822.134.368-2.247-.822-.134Zm-3.37 2.858.799-.688-.544-.632-.8.689.545.631Zm2.253-2.93.264-1.018-.806-.21-.265 1.02.807.209Zm.663-1.218.081.026.255-.794-.08-.026-.256.794ZM6.18 4.117c.173-.325.308-.668.4-1.024l-.807-.21a3.821 3.821 0 0 1-.328.841l.735.393ZM7.324 1.9c.17.054.291.186.33.34l.807-.21a1.325 1.325 0 0 0-.882-.924l-.255.794Zm-.48.174A.286.286 0 0 1 7 1.89l-.362-.75a1.119 1.119 0 0 0-.6.725l.806.209ZM7 1.89a.331.331 0 0 1 .243-.016l.255-.794a1.164 1.164 0 0 0-.86.06L7 1.89Zm1.196 4.543h2.879v-.834H8.196v.834Zm-5.241 5.79-.54-6.243-.83.072.54 6.242.83-.071Zm-.538.059V6.016h-.834v6.266h.834Zm-.292.012a.146.146 0 0 1 .145-.158v.833c.404 0 .72-.345.685-.746l-.83.071Zm6.394-8.996c.07-.422.05-.854-.058-1.268l-.806.21c.078.301.093.616.042.924l.822.134Zm-3.41 8.838a.509.509 0 0 1-.506-.465l-.83.071c.06.694.64 1.227 1.336 1.227v-.833Zm.017-6.802c.378-.326.785-.713 1.054-1.217l-.735-.393c-.193.36-.5.665-.863.978l.544.632Zm7.27 1.837a1.342 1.342 0 0 0-1.321-1.572v.834c.315 0 .555.284.5.596l.822.142ZM2.27 12.136c.082 0 .147.066.147.146h-.834c0 .379.307.687.687.687v-.833ZM7.33 5.41a.88.88 0 0 0 .867 1.022v-.834a.046.046 0 0 1-.045-.054l-.822-.134ZM4.152 6.452a.51.51 0 0 1 .175-.43l-.544-.631a1.343 1.343 0 0 0-.462 1.133l.83-.072Z"/>
                </svg></button></div>
                </div><br> `,console.log(`New Message:
[${n.role}] ${n.content}`),document.getElementById(`${n.id}_plus`).addEventListener("click",()=>Se(n.id,1),{once:!0}),document.getElementById(`${n.id}_minus`).addEventListener("click",()=>Se(n.id,-1),{once:!0})}}else if(n){if(n.id&&oe.has(n.id))return;n.id&&oe.add(n.id),te.innerHTML+=`<div class="userMessage">${n.content} </div><br>`,console.log(`New Message:
[${n.role}] ${n.content}`)}te.scrollTo({top:te.scrollHeight+50,behavior:"smooth"})}},onAgentActivityStateChange(e){console.log("Agent Activity State: ",e),e=="TALKING"?(fe.style.display="inline-flex",Q.style.display="none",X.style.display="none"):(fe.style.display="none",Q.style.display="inline-flex",X.style.display="inline-flex")},onError(e,t){console.log("Error:",e,"Error Data:",t)}};let $t={compatibilityMode:"on",streamWarmup:!0,fluent:!0};function Pt(){let e=W.value;e!==""&&e.length>2&&(P.speak({type:"text",input:e}),console.log(`Speak: "${e}"`),W.value="")}function xt(){let e=W.value;e!==""&&(P.chat(e),console.log(`Chat: ("${e}")`),W.value="")}function Lt(){P.interrupt({type:"click"}),console.log("Interrupt")}function Se(e,t){let a=P.rate(e,t);console.log(`Message ID: ${e} Rated:${t}
`,"Result",a)}function Bt(){P.reconnect(),console.log("Reconnect")}_e.clientKey==""&&(console.error("Missing agentID and auth.clientKey variables"),console.log(`Missing agentID and auth.clientKey variables:

Fetch the data-client-key and the data-agent-id as explained on the Agents SDK Overview Page:
https://docs.d-id.com/reference/agents-sdk-overview

Paste these into their respective variables at the top of the main.js file and save.`));function ke(){const e=document.querySelectorAll('#buttons input[name="option"]'),a=(Array.from(e).findIndex(n=>n.checked)+1)%e.length;e[a].checked=!0}function he(){const e=document.querySelector('input[name="option"]:checked').value;e==="chat"?xt():e==="speak"&&Pt()}X.addEventListener("click",he);Q.addEventListener("click",()=>toggleStartStop());_t.addEventListener("click",()=>Bt());fe.addEventListener("click",()=>Lt());window.addEventListener("load",()=>{W.focus(),X.setAttribute("disabled",!0),Q.setAttribute("disabled",!0)});let P=await jt(Ae,{auth:_e,callbacks:At,streamOptions:$t});console.log("Create Agent Manager: ",P);console.log("Connecting to Agent ID: ",Ae);await P.connect();se=P.getStreamType();console.log("Stream Type:",se);
